ekf_filter_node:
  ros__parameters:
    frequency: 30.0
    two_d_mode: false
    publish_tf: true
    
    map_frame: map
    odom_frame: odom
    base_link_frame: base_link
    world_frame: odom

    # --- SOURCE 1: FILTERED LIDAR ICP ---
    # Now listening to the gated topic
    odom0: /odom_lidar_filtered  # <--- CHANGED
    
    # We trust X, Y, Yaw from LiDAR
    odom0_config: [true, true, false, false, false, true, 
                   false, false, false, false, false, false,
                   false, false, false]
    
    # Differential FALSE because ICP gives absolute map corrections
    odom0_differential: false 
    
    # We still keep these rejection thresholds as a backup safety net
    odom0_n_sigma: 5.0
    odom0_pose_rejection_threshold: 2.0

    odom1: /odom_hybrid
    
    # Trust EVERYTHING (because we already filtered the bad data in Python)
    odom1_config: [true, true, true, true, true, true, 
                   false, false, false, false, false, false,
                   false, false, false]
    
    odom1_differential: false
    odom1_relative: true   # Handle the startup offset
    odom1_queue_size: 10
    
    # Use the safety variance we discussed
    min_measurement_covariance: [0.05, 0.05, 0.05, 0.05, 0.05, 0.05, 
                                 0.05, 0.05, 0.05, 0.05, 0.05, 0.05,
                                 0.05, 0.05, 0.05]